{% extends "base.html" %}

{% block title %}إضافة منتج جديد - متجر العبايات{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h2 class="mb-0">إضافة منتج جديد</h2>
    <a href="{{ url_for('admin_products') }}" class="btn btn-secondary">
      <i class="bi bi-arrow-left"></i> رجوع
    </a>
  </div>

  <div class="row">
    <div class="col-lg-8 mx-auto">
      <div class="card shadow">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">معلومات المنتج</h6>
        </div>
        <div class="card-body">
          <form method="POST" enctype="multipart/form-data" id="productForm">
            {{ form.hidden_tag() }}

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="name" class="form-label">اسم المنتج</label>
                {{ form.name(class="form-control", id="name", placeholder="أدخل اسم المنتج") }}
                {% for error in form.name.errors %}
                <div class="text-danger">{{ error }}</div>
                {% endfor %}
              </div>

              <div class="col-md-6 mb-3">
                <label for="category" class="form-label">الفئة</label>
                {{ form.category(class="form-select", id="category") }}
                {% for error in form.category.errors %}
                <div class="text-danger">{{ error }}</div>
                {% endfor %}
              </div>
            </div>

            <div class="mb-3">
              <label for="description" class="form-label">الوصف</label>
              {{ form.description(class="form-control", id="description", rows="4", placeholder="أدخل وصف المنتج") }}
              {% for error in form.description.errors %}
              <div class="text-danger">{{ error }}</div>
              {% endfor %}
            </div>

            <div class="row">
              <div class="col-md-4 mb-3">
                <label for="price" class="form-label">السعر (ر.س)</label>
                {{ form.price(class="form-control", id="price", placeholder="0.00", step="0.01", min="0") }}
                {% for error in form.price.errors %}
                <div class="text-danger">{{ error }}</div>
                {% endfor %}
              </div>

              <div class="col-md-4 mb-3">
                <label for="stock" class="form-label">الكمية في المخزون</label>
                {{ form.stock(class="form-control", id="stock", placeholder="0", min="0") }}
                {% for error in form.stock.errors %}
                <div class="text-danger">{{ error }}</div>
                {% endfor %}
              </div>

              <div class="col-md-4 mb-3">
                <label for="discount" class="form-label">خصم (%)</label>
                {{ form.discount(class="form-control", id="discount", placeholder="0", min="0", max="100") }}
                {% for error in form.discount.errors %}
                <div class="text-danger">{{ error }}</div>
                {% endfor %}
              </div>
            </div>

            <div class="mb-3">
              <label for="images" class="form-label">صور المنتج</label>
              {{ form.images(class="form-control", id="images", accept="image/*", multiple="multiple") }}
              {% for error in form.images.errors %}
              <div class="text-danger">{{ error }}</div>
              {% endfor %}
              <div class="form-text">
                يمكنك اختيار أكثر من صورة. الصيغ المسموحة: JPG, PNG, GIF. الحجم الأقصى: 5MB للصورة
              </div>

              <!-- معاينة الصور -->
              <div id="image-preview" class="mt-3 row g-2"></div>
            </div>

            <div class="mb-3">
              <div class="form-check">
                {{ form.is_active(class="form-check-input", id="is_active", checked=True) }}
                <label class="form-check-label" for="is_active">منتج نشط</label>
              </div>
            </div>

            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
              <button type="reset" class="btn btn-secondary">إعادة تعيين</button>
              <button type="submit" class="btn btn-primary">حفظ المنتج</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript لمعاينة الصور -->
<script>
document.getElementById('images').addEventListener('change', function(event) {
  const preview = document.getElementById('image-preview');
  preview.innerHTML = '';
  
  const files = event.target.files;
  
  for (let i = 0; i < files.length; i++) {
    const file = files[i];
    
    if (file.type.startsWith('image/')) {
      const reader = new FileReader();
      
      reader.onload = function(e) {
        const col = document.createElement('div');
        col.className = 'col-md-3';
        
        const card = document.createElement('div');
        card.className = 'card';
        
        const img = document.createElement('img');
        img.src = e.target.result;
        img.className = 'card-img-top';
        img.style.height = '150px';
        img.style.objectFit = 'cover';
        
        const cardBody = document.createElement('div');
        cardBody.className = 'card-body p-2';
        
        const fileName = document.createElement('small');
        fileName.className = 'text-muted';
        fileName.textContent = file.name;
        
        cardBody.appendChild(fileName);
        card.appendChild(img);
        card.appendChild(cardBody);
        col.appendChild(card);
        preview.appendChild(col);
      };
      
      reader.readAsDataURL(file);
    }
  }
});
</script>
{% endblock %}